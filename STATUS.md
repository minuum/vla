# VLA 데이터 수집 프로젝트 진행 상황

## ✅ Done (완료)

### 2025-01-13 (최신)
- **복귀 및 자동 측정 정지 메커니즘 통일**
  - 복귀(B), 자동 측정(A), 수동 입력(N) 모두 동일한 정지 메커니즘 사용
  - 타이머 + 8회 정지 신호 발행 (stop_movement_internal 5회 + 추가 3회)
  - 18프레임 정규화: 복귀 시 부족하면 STOP_ACTION 패딩, 초과하면 잘라냄
  - 이동 시간: 0.4초, 안정화 대기: 0.3초

- **함수 및 기능 문서화**
  - `FUNCTIONS_DOCUMENTATION.md` 생성
  - 20개 주요 함수 상세 설명
  - 워크플로우 다이어그램
  - 변경 이력 추적 시스템

- **이동 시간 최적화**
  - 키 입력 기반 이동: 0.3초 → 0.4초 (33% 증가)
  - 자동 측정 이동: 0.31초 → 0.4초
  - 복귀 이동: 0.3초 → 0.4초
  - 목적: 정지 신호 강화 후 이동 거리 감소 보완

- **U 키 가이드 갱신 기능 구현**
  - 마지막 완료된 에피소드의 키 입력 시퀀스 자동 저장
  - 반복 횟수 입력 화면에서 U 키로 즉시 가이드 저장 가능
  - 18키 자동 정규화 및 core_patterns.json 저장
  - 가이드 갱신 워크플로우 개선 (H: 수동 편집, U: 자동 적용)

- **로봇 정지 문제 해결**
  - 타이머 시작 순서 변경 (블로킹 전 타이머 시작)
  - 정지 명령 발행 강화 (총 8회)
  - threading.Lock으로 타이머 동기화
  - 이미지 서비스 타임아웃 단축 (10초 → 2초)

- **가이드 편집 기능 구현**
  - H 키로 가이드 직접 편집 모드 진입
  - WASD/QEZC 키 입력으로 가이드 작성
  - Enter로 저장, X로 취소
  - Backspace로 마지막 키 삭제

### 이전 작업
- 시나리오/패턴/거리 선택 UI 개선
- 반복 측정 기능 구현
- 데이터 수집 통계 및 진행률 표시
- H5 파일 검증 및 추출 기능
- 자동 복귀 기능
- 자동 측정 기능

---

## 🔄 In Progress (진행 중)

현재 진행 중인 작업이 없습니다.

---

## 📝 Todo (할 일)

### 🔥 High Priority

1. **카메라 초기화 실패 문제 해결**
   - 파일: `ROS_action/src/camera_pub/camera_pub/camera_publisher_continuous.py`
   - 증상: `Failed to create CaptureSession`, 웜업 프레임 읽기 실패
   - 원인: CSI 카메라 하드웨어/드라이버 문제 또는 프로세스 충돌
   - 해결 방안:
     - [ ] 충돌 프로세스 확인 및 종료
     - [ ] 카메라 하드웨어 권한 확인
     - [ ] 웜업 실패 시 가상 카메라로 자동 전환 로직 구현

2. **데이터 수집 진행**
   - 현재: 23/1000 (2.3%)
   - 시나리오별 목표:
     - 1box_left: 23/250 (9.2%)
     - 1box_right: 0/250 (0%)
     - 2box_left: 0/250 (0%)
     - 2box_right: 0/250 (0%)

### 🔧 Medium Priority

3. **가이드 시스템 개선**
   - [ ] 가이드 검증 로직 추가 (너무 짧거나 긴 가이드 경고)
   - [ ] 가이드 히스토리 관리 (이전 가이드로 롤백)
   - [ ] 시나리오별 권장 가이드 템플릿

4. **데이터 품질 개선**
   - [ ] 수집된 데이터 품질 자동 검증
   - [ ] 이상 데이터 감지 및 재수집 제안
   - [ ] 시간대별 균형 잡힌 수집 가이드

### 💡 Low Priority

5. **UI/UX 개선**
   - [ ] 진행 상황 그래프 시각화
   - [ ] 단축키 도움말 화면 개선
   - [ ] 에러 메시지 한글화 및 명확화

6. **성능 최적화**
   - [ ] 이미지 압축 최적화
   - [ ] H5 파일 저장 속도 개선
   - [ ] 메모리 사용량 모니터링

---

## 📊 데이터 수집 현황

### 전체 진행률
- **총 수집**: 23/1000 (2.3%)
- **목표**: 1000개 에피소드
- **남은 개수**: 977개

### 시나리오별 진행률
| 시나리오 | 진행 | 목표 | 비율 | 남은 개수 |
|---------|------|------|------|-----------|
| 1box_left | 23 | 250 | 9.2% | 227 |
| 1box_right | 0 | 250 | 0% | 250 |
| 2box_left | 0 | 250 | 0% | 250 |
| 2box_right | 0 | 250 | 0% | 250 |

### 시간대별 통계
- 새벽 (00:00-06:00): 1개 (목표: 200)
- 아침 (06:00-12:00): 3개 (목표: 200)
- 저녁 (12:00-18:00): 19개 (목표: 300)
- 밤 (18:00-00:00): 0개 (목표: 300)

---

## 🔧 기술 스택

- **ROS2**: Foxy
- **Python**: 3.8+
- **데이터 형식**: HDF5 (.h5)
- **카메라**: NVIDIA Jetson CSI Camera (nvarguscamerasrc)
- **로봇**: pop.driving 기반 모바일 로봇

---

## 📝 메모

### 최근 이슈 및 해결
1. **로봇 정지 문제** (2025-01-13 해결)
   - 원인: 이미지 수집 블로킹으로 타이머 지연
   - 해결: 타이머 시작 순서 변경 + 정지 명령 강화

2. **이동 거리 감소 문제** (2025-01-13 해결)
   - 원인: 정지 신호 강화로 상대적으로 이동 시간 짧음
   - 해결: 이동 시간 0.4초로 증가

### 다음 세션 계획
1. 카메라 초기화 문제 해결
2. 1box_left 시나리오 100개 수집 목표
3. 다른 시나리오 데이터 수집 시작

---

마지막 업데이트: 2025-01-13

