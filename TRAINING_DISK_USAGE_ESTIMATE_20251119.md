# 학습 디스크 사용량 전체 견적 (2025-11-19)

## 현재 학습 설정

### 데이터셋 정보
- **에피소드 수**: 231개
- **데이터셋 총 크기**: 5.66GB
- **평균 파일 크기**: 25.10MB
- **Train/Val 분할**: 80% / 20% (약 185개 / 46개)

### 학습 하이퍼파라미터
- **Batch size**: 1
- **Gradient accumulation**: 8
- **Effective batch size**: 8
- **Window size**: 8
- **Forward prediction (fwd_pred_next_n)**: 10
- **Max epochs**: 20

### 체크포인트 정보
- **체크포인트당 크기**: **6.9GB** (실제 측정값)
- **구성**: Backbone + LoRA + Policy Head + Optimizer states

---

## 에폭 수별 디스크 사용량 견적

### 현재 설정 (save_top_k=-1, every_n_epochs=1)

| Epochs | 체크포인트 수 | 체크포인트 용량 | TensorBoard 로그 | CSV 로그 | **총 예상 용량** |
|--------|--------------|----------------|-----------------|----------|------------------|
| 5      | 5개          | 34.5GB         | ~50MB           | ~1MB     | **~34.6GB**      |
| 10     | 10개         | 69GB           | ~100MB          | ~2MB     | **~69.1GB**      |
| 20     | 20개         | 138GB          | ~200MB          | ~4MB     | **~138.2GB**     |
| 50     | 50개         | 345GB          | ~500MB          | ~10MB    | **~345.5GB**     |
| 100    | 100개        | 690GB          | ~1GB            | ~20MB    | **~691GB**       |

### 권장 설정 (save_top_k=3, every_n_epochs=5, monitor="val_loss")

| Epochs | 체크포인트 수 | 체크포인트 용량 | TensorBoard 로그 | CSV 로그 | **총 예상 용량** |
|--------|--------------|----------------|-----------------|----------|------------------|
| 5      | 1-2개        | 6.9-13.8GB     | ~50MB           | ~1MB     | **~7-14GB**      |
| 10     | 2-3개        | 13.8-20.7GB    | ~100MB          | ~2MB     | **~14-21GB**     |
| 20     | 3-4개        | 20.7-27.6GB    | ~200MB          | ~4MB     | **~21-28GB**     |
| 50     | 3-4개        | 20.7-27.6GB    | ~500MB          | ~10MB    | **~21-28GB**     |
| 100    | 3-4개        | 20.7-27.6GB    | ~1GB            | ~20MB    | **~21-28GB**     |

### 최소 설정 (save_top_k=1, monitor="val_loss")

| Epochs | 체크포인트 수 | 체크포인트 용량 | TensorBoard 로그 | CSV 로그 | **총 예상 용량** |
|--------|--------------|----------------|-----------------|----------|------------------|
| 5      | 1개          | 6.9GB          | ~50MB           | ~1MB     | **~7GB**         |
| 10     | 1개          | 6.9GB          | ~100MB          | ~2MB     | **~7GB**         |
| 20     | 1개          | 6.9GB          | ~200MB          | ~4MB     | **~7GB**         |
| 50     | 1개          | 6.9GB          | ~500MB          | ~10MB    | **~7GB**         |
| 100    | 1개          | 6.9GB          | ~1GB            | ~20MB    | **~7GB**         |

---

## 데이터셋 크기별 영향

### 데이터셋 크기와 디스크 사용량 관계

데이터셋 크기는 **체크포인트 크기에 직접적인 영향을 주지 않습니다**. 체크포인트는 모델 가중치만 저장하므로 데이터셋 크기와 무관합니다.

하지만 **학습 시간과 로그 파일 크기**에는 영향을 줍니다:

| 데이터셋 크기 | 에피소드 수 | Steps/Epoch | 학습 시간 (20 epoch) | TensorBoard 로그 |
|-------------|------------|-------------|---------------------|------------------|
| 5.66GB      | 231개      | ~171        | ~1.3시간            | ~200MB           |
| 11.32GB     | 462개      | ~342        | ~2.6시간            | ~400MB           |
| 22.64GB     | 924개      | ~684        | ~5.2시간            | ~800MB           |
| 56.6GB      | 2310개     | ~1710       | ~13시간             | ~2GB             |

**참고**: 학습 시간은 GPU 성능, 배치 크기 등에 따라 달라질 수 있습니다.

---

## 전체 디스크 사용량 종합 견적

### 시나리오별 총 디스크 사용량

#### 시나리오 1: 현재 설정 (20 epochs, save_top_k=-1)
```
모델 파일 (.vlms):           25GB
학습 데이터셋:                5.66GB
체크포인트 (20개):           138GB
TensorBoard 로그:            0.2GB
CSV 로그:                    0.004GB
기타 (코드, 캐시 등):        ~1GB
───────────────────────────────
총 예상 사용량:              ~170GB
```

#### 시나리오 2: 권장 설정 (20 epochs, save_top_k=3)
```
모델 파일 (.vlms):           25GB
학습 데이터셋:                5.66GB
체크포인트 (3-4개):          21-28GB
TensorBoard 로그:            0.2GB
CSV 로그:                    0.004GB
기타 (코드, 캐시 등):        ~1GB
───────────────────────────────
총 예상 사용량:              ~53-60GB
```

#### 시나리오 3: 최소 설정 (20 epochs, save_top_k=1)
```
모델 파일 (.vlms):           25GB
학습 데이터셋:                5.66GB
체크포인트 (1개):            6.9GB
TensorBoard 로그:            0.2GB
CSV 로그:                    0.004GB
기타 (코드, 캐시 등):        ~1GB
───────────────────────────────
총 예상 사용량:              ~39GB
```

---

## 에폭 수별 권장 체크포인트 저장 전략

### 단기 학습 (5-10 epochs)
```python
ModelCheckpoint(
    save_top_k=2,              # 최고 성능 2개
    every_n_epochs=1,          # 매 epoch 체크
    monitor="val_loss",
    mode="min"
)
```
- **예상 저장량**: 2개 × 6.9GB = **13.8GB**

### 중기 학습 (20-50 epochs)
```python
ModelCheckpoint(
    save_top_k=3,              # 최고 성능 3개
    every_n_epochs=5,          # 5 epoch마다 체크
    monitor="val_loss",
    mode="min",
    save_last=True             # 마지막 epoch도 저장
)
```
- **예상 저장량**: 3-4개 × 6.9GB = **20.7-27.6GB**

### 장기 학습 (100+ epochs)
```python
ModelCheckpoint(
    save_top_k=3,              # 최고 성능 3개
    every_n_epochs=10,         # 10 epoch마다 체크
    monitor="val_loss",
    mode="min",
    save_last=True             # 마지막 epoch도 저장
)
```
- **예상 저장량**: 3-4개 × 6.9GB = **20.7-27.6GB**

---

## 데이터셋 확장 시 견적

### 데이터셋 크기 증가에 따른 영향

| 데이터셋 크기 | 에피소드 수 | Steps/Epoch | 학습 시간 (20 epoch) | 로그 크기 | 체크포인트 크기 |
|-------------|------------|-------------|---------------------|----------|----------------|
| 5.66GB (현재) | 231개     | ~171        | ~1.3시간            | ~200MB   | 6.9GB (변화 없음) |
| 11.32GB     | 462개      | ~342        | ~2.6시간            | ~400MB   | 6.9GB (변화 없음) |
| 22.64GB     | 924개      | ~684        | ~5.2시간            | ~800MB   | 6.9GB (변화 없음) |
| 56.6GB      | 2310개     | ~1710       | ~13시간             | ~2GB     | 6.9GB (변화 없음) |

**핵심**: 데이터셋 크기가 커져도 **체크포인트 크기는 동일**합니다. 다만 학습 시간과 로그 파일 크기만 증가합니다.

---

## 디스크 공간 관리 권장사항

### 1. 체크포인트 저장 전략
- ✅ **권장**: `save_top_k=3`, `every_n_epochs=5`, `monitor="val_loss"`
- ✅ **최소**: `save_top_k=1`, `monitor="val_loss"`
- ❌ **비권장**: `save_top_k=-1` (모든 체크포인트 저장)

### 2. 주기적 정리
- 매주 이전 체크포인트 확인 및 삭제
- 최고 성능 체크포인트만 보존
- TensorBoard 로그는 보관 (용량 작음)

### 3. 디스크 공간 모니터링
- 학습 시작 전 최소 50GB 여유 공간 확보 권장
- 체크포인트 저장 실패 시 즉시 조치

---

## 결론 및 권장사항

### 현재 상황 (20 epochs 기준)
- **현재 설정**: 138GB 필요 (부족!)
- **권장 설정**: 21-28GB 필요 (충분)
- **최소 설정**: 7GB 필요 (충분)

### 최적 설정 추천
```python
ModelCheckpoint(
    dirpath=configs["output_dir"],
    save_top_k=3,              # 최고 성능 3개만
    every_n_epochs=5,          # 5 epoch마다 체크
    monitor="val_loss",        # validation loss 기준
    mode="min",                # loss 최소화
    save_last=True,            # 마지막 epoch도 저장
    filename="epoch_{epoch:02d}-val_loss={val_loss:.3f}"
)
```

**예상 저장량**: 최대 4개 (최고 3개 + 마지막 1개) = **27.6GB**

### 데이터셋 확장 시
- 데이터셋이 2배, 4배 증가해도 체크포인트 크기는 동일
- 학습 시간과 로그 파일만 증가
- 디스크 공간 걱정 없이 데이터셋 확장 가능

