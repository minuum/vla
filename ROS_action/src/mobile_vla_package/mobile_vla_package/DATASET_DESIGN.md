# 📊 데이터셋 설계 원칙 및 카테고리 설명

## 🔍 Variant 패턴이 필요한 이유

### 1. **학습 다양성 확보 (Generalization)**
- **Core 패턴**: 표준화된 일관성 있는 경로 (예: `W W W → A A → W W → D D`)
  - 목적: 기본 동작 패턴을 안정적으로 학습
  - 특징: 가이드에 따라 정확히 따라하는 "표준" 데이터
  
- **Variant 패턴**: 핵심 패턴의 변형 (타이밍/순서/세분화 조정)
  - 목적: 다양한 상황 대응 능력 학습
  - 특징: 같은 목표를 달성하지만 다른 경로로 도달하는 "창의적" 데이터

### 2. **실제 환경의 불확실성 대응**
```
실제 로봇 환경:
- 장애물 위치가 정확히 표준 위치가 아닐 수 있음
- 센서 노이즈로 인한 작은 오차
- 환경 변화 (조명, 그림자 등)

→ Variant 데이터로 이런 변동성 학습
```

### 3. **모델의 Robustness 향상**
- **Core만 학습**: 고정된 경로에만 최적화 → 실제 환경에서 실패 가능성 높음
- **Core + Variant**: 다양한 경로 학습 → 환경 변화에 유연하게 대응

### 4. **데이터 효율성**
- Core: 150개 (60%) - 기본 패턴 확보
- Variant: 100개 (40%) - 다양성 확보
- **비율 근거**: 표준 패턴이 더 중요하지만, 변형도 필요

### 5. **학습 안정성 vs. 창의성 균형**
```
Core (150개):
  → 모델이 "표준 답"을 학습
  → 예측 가능하고 안정적인 동작

Variant (100개):
  → 모델이 "다양한 해결책"을 학습
  → 새로운 상황에 대응 가능
```

---

## 📋 카테고리 분류 체계 및 합당성

### 현재 카테고리 설정 (프레임 수 기준)

| 카테고리 | 프레임 범위 | 목표 개수 | 비율 | 설명 | 합당성 |
|---------|-----------|----------|------|------|--------|
| **short** | 1-10 | 100 | 10% | 짧은 에피소드 | ✅ |
| **medium** | 11-25 | 700 | 70% | 중간 에피소드 | ✅ |
| **long** | 26-50 | 150 | 15% | 긴 에피소드 | ✅ |
| **extra_long** | 51+ | 50 | 5% | 매우 긴 에피소드 | ✅ |

**총합**: 1000개

### 카테고리별 상세 분석

#### 1. **short (1-10 프레임) - 100개 (10%)**
- **의미**: 매우 짧은 동작 (예: 정지, 미세 조정)
- **합당성**: ✅ 필요하지만 비중 낮음
  - 실용성: 실제로는 드묾
  - 목적: 특수 상황 데이터 (예: 정지 후 재시작)
  - 비율: 10% 적절 (너무 많으면 노이즈)

#### 2. **medium (11-25 프레임) - 700개 (70%)**
- **의미**: 표준 에피소드 길이 (18스텝 포함)
- **합당성**: ✅ **핵심 카테고리**
  - 실제 사용: 대부분의 태스크가 이 범위
  - 18스텝 고정: RoboVLMs 표준과 일치
  - 비율: 70% 적절 (주 학습 데이터)

#### 3. **long (26-50 프레임) - 150개 (15%)**
- **의미**: 복잡한 경로나 다중 장애물 회피
- **합당성**: ✅ 다양성 확보
  - 실용성: 복잡한 시나리오 학습
  - 목적: 긴 시퀀스 처리 능력
  - 비율: 15% 적절 (너무 많으면 학습 부담)

#### 4. **extra_long (51+ 프레임) - 50개 (5%)**
- **의미**: 매우 복잡한 장기 시퀀스
- **합당성**: ⚠️ **재검토 필요**
  - 실용성: 실제로 거의 사용되지 않을 수 있음
  - 목적: 엣지 케이스 학습
  - 비율: 5%는 적절하지만, 필요성 의문

### 카테고리 분류 기준의 문제점 및 개선안

#### 현재 문제점
1. **프레임 수만 기준**: 실제 태스크 복잡도와 무관
2. **18스텝 고정**: medium에만 집중되는 경향
3. **실용성 불일치**: extra_long이 실제로 필요한가?

#### 개선 제안
```python
# 현재 (프레임 수 기준)
categories = {
    "short": {"min": 1, "max": 10, "target": 100},
    "medium": {"min": 11, "max": 25, "target": 700},
    "long": {"min": 26, "max": 50, "target": 150},
    "extra_long": {"min": 51, "max": float('inf'), "target": 50}
}

# 개선안 1: 태스크 복잡도 기준
categories = {
    "simple": {"description": "단순 회피 (1박스)", "target": 400},
    "moderate": {"description": "중간 복잡도 (2박스)", "target": 400},
    "complex": {"description": "복잡한 경로", "target": 200}
}

# 개선안 2: 프레임 수 + 태스크 성공 여부
categories = {
    "standard": {"frames": 18, "target": 700, "description": "표준 18스텝"},
    "short_episode": {"frames": "<18", "target": 100},
    "long_episode": {"frames": ">18", "target": 200}
}
```

---

## 📊 현재 설정의 합당성 종합 평가

### ✅ 잘 설정된 부분
1. **medium 비율 (70%)**: 표준 18스텝에 집중
2. **Core/Variant 비율 (60/40)**: 표준과 다양성 균형
3. **시간대 분포**: 밤(50%) > 새벽(30%) > 낮(20%)

### ⚠️ 재검토 필요한 부분
1. **extra_long 카테고리**: 실제 필요성 확인 필요
2. **short 카테고리**: 목표 100개가 과도할 수 있음
3. **카테고리 기준**: 프레임 수만으로는 부족

### 💡 권장 사항
1. **extra_long → long으로 통합** 또는 **목표 감소** (50 → 20)
2. **short 목표 감소** (100 → 50)
3. **medium 목표 증가** (700 → 800) - 18스텝 중심
4. **카테고리 기준 다변화**: 프레임 수 + 태스크 성공률 + 복잡도

---

## 🎯 최종 권장 설정

```python
# 개선된 카테고리 설정
categories = {
    "short": {"min": 1, "max": 10, "target": 50, "description": "짧은 에피소드"},
    "medium": {"min": 11, "max": 25, "target": 800, "description": "중간 에피소드 (18스텝 중심)"},  
    "long": {"min": 26, "max": 50, "target": 130, "description": "긴 에피소드"},
    "extra_long": {"min": 51, "max": float('inf'), "target": 20, "description": "매우 긴 에피소드"}
}
# 총합: 1000개
# 비율: 5% / 80% / 13% / 2%
```

**변경 근거**:
- medium 비율 증가: 18스텝 중심 학습 강화
- short/extra_long 감소: 실제 사용 빈도 반영
- long 유지: 복잡한 시나리오 학습 유지

