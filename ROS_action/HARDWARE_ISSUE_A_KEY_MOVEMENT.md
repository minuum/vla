# 하드웨어 이슈: A 키(왼쪽 이동) 움직임 문제

**작성일**: 2025-11-27  
**이슈 발생 기간**: 2025-11-26 ~ 2025-11-27  
**상태**: 해결됨 (하드웨어 점검 완료)

---

## 🔍 문제 개요

자동 측정 중 A 키를 눌렀을 때 로봇이 왼쪽으로 이동하지 않고 회전하는 현상이 발생했습니다.

### 증상

- **예상 동작**: A 키 입력 시 `linear_y = 1.15`로 왼쪽 이동
- **실제 동작**: 회전 동작 발생 (각도 이동)
- **영향**: 자동 측정 시 가이드 패턴의 A 키 액션이 제대로 실행되지 않음

---

## 🔧 원인 분석

### 소프트웨어 측면

초기에는 소프트웨어 문제로 의심하여 다음을 확인했습니다:

1. **액션 매핑 확인**
   - `WASD_TO_CONTINUOUS` 딕셔너리에서 A 키 매핑: `{"linear_x": 0.0, "linear_y": 1.15, "angular_z": 0.0}`
   - ✅ 정상: A 키는 `linear_y = 1.15`로 올바르게 매핑됨

2. **각도 계산 확인**
   - `arctan2(linear_y, linear_x)` 계산 결과: 90도
   - ✅ 정상: 왼쪽 이동에 대한 각도 계산이 올바름

3. **하드웨어 제어 확인**
   - `driver.move(angle, throttle)` 호출 확인
   - ✅ 정상: 90도 각도로 이동 명령이 올바르게 전달됨

### 하드웨어 측면

소프트웨어 로직은 정상이었으나, 실제 로봇 동작에서 문제가 발생했습니다.

**최종 원인**: **옴니휠의 뒷바퀴 1개의 나사가 덜 조여져 있거나 마모되어 있는 경우**

**해결 조치**: 바퀴 교체 완료 (2025-11-27)

옴니휠 로봇은 4개의 바퀴로 구성되어 있으며, 각 바퀴의 균형이 중요합니다:
- 한 바퀴의 나사가 느슨하거나 마모되면 해당 방향의 힘 전달이 불균형해짐
- 왼쪽 이동(linear_y) 시 뒷바퀴 중 하나의 문제로 인해 회전 모멘트가 발생
- 결과적으로 직선 이동 대신 회전 동작이 발생

---

## 🛠️ 해결 방법

### 하드웨어 점검 및 수리

1. **옴니휠 바퀴 점검**
   - 모든 바퀴의 나사 조임 상태 확인
   - 바퀴 마모 상태 확인
   - 특히 뒷바퀴 1개에 집중 점검

2. **나사 조임**
   - 느슨한 나사 발견 시 적절한 토크로 조임
   - 모든 바퀴의 나사 균형 확인

3. **바퀴 교체** ✅ 완료 (2025-11-27)
   - 마모가 심한 뒷바퀴 교체 완료
   - 교체 후 균형 재확인 및 테스트 완료
   - 정상 동작 확인 후 데이터 수집 재개

---

## 📊 영향 범위

### 데이터 수집에 미친 영향

- **영향 받은 에피소드**: A 키가 포함된 가이드 패턴을 사용한 모든 에피소드
- **주요 패턴**: `W W W A Q Q Q Q Q Q Q Q W W W W W`
- **대응**: 하드웨어 점검 후 정상 수집 재개

### 코드 변경 이력

이슈 해결 과정에서 다음과 같은 코드 변경이 있었습니다:

1. **디버깅 로그 추가** (커밋: 77ae8bfd)
   - A 키 동작 추적을 위한 상세 로그 추가
   - 하드웨어 제어 경로 확인

2. **좌표계 변환 시도** (커밋: 43f06090, 이후 revert: 66b40034)
   - 초기에는 좌표계 문제로 의심하여 변환 시도
   - 사용자 피드백으로 하드웨어 문제임을 확인
   - 좌표계 변환 코드는 revert됨

---

## 📝 교훈 및 권장사항

### 정기 점검

1. **주기적 하드웨어 점검**
   - 옴니휠 바퀴 나사 조임 상태 주기적 확인 (주 1회 권장)
   - 바퀴 마모 상태 모니터링

2. **이상 동작 감지**
   - 예상과 다른 동작 발생 시 즉시 하드웨어 점검
   - 소프트웨어 로그 확인 후 하드웨어 점검 진행

### 데이터 수집 시 주의사항

1. **수집 전 점검**
   - 자동 측정 시작 전 로봇 동작 테스트
   - 특히 A, D 키(좌우 이동) 동작 확인

2. **이상 데이터 처리**
   - 이상 동작이 발생한 에피소드는 재수집 고려
   - 하드웨어 문제 해결 후 정상 수집 재개

---

## 🔗 관련 파일

- **데이터 수집 스크립트**: `src/mobile_vla_package/mobile_vla_package/mobile_vla_data_collector.py`
- **액션 매핑**: `WASD_TO_CONTINUOUS` 딕셔너리 (라인 41-53)
- **하드웨어 제어**: `publish_cmd_vel` 함수 (라인 1180-1250)
- **수집 현황**: `DATASET_COLLECTION_STATUS_20251127.md`

---

## ✅ 해결 확인

하드웨어 점검 후 A 키 동작이 정상적으로 작동하는지 확인:

1. 수동 모드에서 A 키 입력 테스트
2. 자동 측정에서 A 키 포함 가이드 패턴 테스트
3. 정상 동작 확인 후 데이터 수집 재개

---

**참고**: 이 문서는 옴니휠 로봇의 하드웨어 이슈 해결 과정을 기록한 것입니다. 향후 유사한 문제 발생 시 참고 자료로 활용하시기 바랍니다.

