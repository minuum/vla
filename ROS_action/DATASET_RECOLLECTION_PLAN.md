# 📋 데이터셋 재수집 계획

**작성일**: 2025-11-26  
**이유**: 바퀴 교체로 인한 성능 변화 (후면바퀴 교체)

---

## 🔍 상황 분석

### 문제 발생 이력
- **2025-11-26 11:40 AM ~ 12:42 PM**: KNU가 잘 안 잡힘
- **2025-11-26 4:51 PM**: 재수집 시작
- **2025-11-26 5:13 PM**: 바퀴 이상(뻑뻑함, 원래 도착위치 근사하여 가지 않음)
- **바퀴 교체**: 후면바퀴 고정 위치 교체 → 바퀴 성능 달라짐

### 백업 완료 현황
- ✅ **H5 파일**: 247개 → `mobile_vla_dataset_legacy`로 이동 완료
- ✅ **JSON 파일**: 4개 백업 완료
  - `core_patterns_backup_20251126_171833.json`
  - `scenario_progress_backup_20251126_171833.json`
  - `time_period_stats_backup_20251126_171833.json`
  - `settings_backup_20251126_171833.json`

---

## 🎯 재수집 목표

### 기본 목표 (변경 없음)
- **총 목표**: 1000개 (시나리오당 250개)
- **프레임 수**: 18프레임 고정 (RoboVLMs 기준: window=8 + pred_next=10)
- **시나리오**: 4개
  - `1box_left`: 250개
  - `1box_right`: 250개
  - `2box_left`: 250개
  - `2box_right`: 250개

### 패턴 분배 (시나리오당)
- **Core**: 150개
  - close: 50개
  - medium: 75개
  - far: 25개
- **Variant**: 100개
  - close: 25개
  - medium: 25개
  - far: 50개

### 시간대 분배 (전체)
- **새벽 (00:00-06:00)**: 200개
- **아침 (06:00-12:00)**: 200개
- **저녁 (12:00-18:00)**: 300개
- **밤 (18:00-24:00)**: 300개

---

## 🔧 재수집 준비 작업

### 1. 가이드 재설정
- [ ] **데이터셋 모드 사용**: `settings.json`에서 `guide_mode: "dataset"` 설정
- [ ] **새 바퀴 성능에 맞는 가이드 테스트**
  - 바퀴 교체 후 성능 변화 확인
  - 실제 수집 테스트로 적절한 가이드 패턴 확인
- [ ] **가이드 업데이트**: 테스트 후 최적 가이드로 `core_patterns.json` 업데이트

### 2. 초기화 작업
- [x] 기존 데이터셋 백업 완료
- [ ] `scenario_progress.json` 초기화 (또는 삭제하여 재생성)
- [ ] `time_period_stats.json` 초기화 (또는 삭제하여 재생성)
- [ ] `core_patterns.json` 초기화 또는 새 가이드로 업데이트

### 3. 바퀴 성능 테스트
- [ ] **기본 이동 테스트**: W/A/S/D 키 동작 확인
- [ ] **대각선 이동 테스트**: Q/E/Z/C 키 동작 확인
- [ ] **회전 테스트**: R/T 키 동작 확인
- [ ] **정지 테스트**: 스페이스바 동작 확인
- [ ] **가이드 패턴 테스트**: 실제 가이드 따라하기 테스트

---

## 📊 재수집 전략

### Phase 1: 가이드 테스트 및 설정 (1-2일)
1. **바퀴 성능 확인**
   - 기본 동작 테스트
   - 정확도 및 일관성 확인
   - 이전 바퀴와의 차이점 파악

2. **가이드 패턴 테스트**
   - 각 시나리오별 가이드 테스트
   - 거리별(close/medium/far) 가이드 조정
   - 최적 가이드 패턴 결정

3. **가이드 저장**
   - 테스트 완료된 가이드를 `core_patterns.json`에 저장
   - 또는 데이터셋 모드 사용 시 `update_guides_from_dataset.py` 실행

### Phase 2: 소규모 수집 테스트 (1일)
1. **각 시나리오별 5-10개 수집**
   - `1box_left__core__medium`: 10개
   - `1box_right__core__medium`: 10개
   - `2box_left__core__medium`: 10개
   - `2box_right__core__medium`: 10개

2. **데이터 품질 확인**
   - 궤적 패턴 일관성 확인
   - 프레임 수 확인 (18프레임 목표)
   - 도착 위치 정확도 확인

3. **가이드 조정 (필요시)**
   - 문제 발견 시 가이드 재조정
   - 재테스트 후 본격 수집 시작

### Phase 3: 본격 수집 (2-3주)
1. **우선순위 수집**
   - Core 패턴 우선 수집
   - Medium 거리 우선 수집
   - 시간대별 균등 분배

2. **진행 상황 모니터링**
   - `P` 키로 진행 상황 확인
   - 패턴별, 거리별 진행 상황 확인
   - 시간대별 진행 상황 확인

3. **품질 관리**
   - 주기적으로 데이터 품질 확인
   - 문제 발견 시 즉시 조정

---

## 📝 체크리스트

### 준비 단계
- [x] 기존 데이터셋 백업 완료
- [ ] `settings.json` 확인 및 설정
- [ ] `scenario_progress.json` 초기화
- [ ] `time_period_stats.json` 초기화
- [ ] 바퀴 성능 테스트 완료
- [ ] 가이드 패턴 테스트 완료
- [ ] 가이드 저장 완료

### 수집 단계
- [ ] Phase 1: 가이드 테스트 및 설정
- [ ] Phase 2: 소규모 수집 테스트
- [ ] Phase 3: 본격 수집 시작
- [ ] 진행 상황 정기 모니터링
- [ ] 데이터 품질 정기 확인

---

## 🔄 가이드 모드 선택

### 데이터셋 모드 (권장)
- **설정**: `settings.json`에서 `guide_mode: "dataset"`
- **장점**: 
  - 수집된 데이터에서 자동으로 최다 패턴 추출
  - 데이터와 가이드 일관성 유지
- **사용법**: 
  - 수집 후 `update_guides_from_dataset.py` 실행하여 가이드 업데이트

### 수동 모드
- **설정**: `settings.json`에서 `guide_mode: "manual"`
- **장점**: 
  - 수동으로 가이드 설정 가능
  - H 키로 가이드 편집 가능
- **사용법**: 
  - H 키로 가이드 편집
  - U 키로 방금 수집한 패턴을 가이드로 저장

---

## 📌 참고사항

### 바퀴 교체 영향
- **후면바퀴 교체**: 이동 성능 및 정확도 변화
- **대응**: 가이드 패턴 재조정 필요
- **주의**: 이전 데이터셋과의 일관성 유지 어려움

### 데이터 품질 관리
- **프레임 수**: 18프레임 목표 (초기 1개 + 액션 17개)
- **도착 위치**: 정확한 도착 위치 확인
- **궤적 일관성**: 같은 조합에서 일관된 궤적 유지

---

## 🚀 다음 단계

1. **바퀴 성능 테스트** 실행
2. **가이드 패턴 테스트** 실행
3. **소규모 수집 테스트** 실행
4. **본격 수집** 시작

---

**마지막 업데이트**: 2025-11-26 17:18

